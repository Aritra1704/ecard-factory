{% extends "base.html" %}

{% block content %}
<div class="space-y-6">
  <div class="flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between">
    <div>
      <p class="text-sm uppercase tracking-[0.2em] text-zinc-500">Card #{{ card.id }}</p>
      <h2 class="mt-2 text-3xl font-semibold text-white">{{ card.theme_name }}</h2>
      <div class="mt-3">
        <span class="inline-flex rounded-full px-3 py-1 text-xs font-medium ring-1 {{ status_badge_class(card.status) }}">
          {{ card.status }}
        </span>
      </div>
    </div>
    <form method="post" action="/admin/cards/{{ card.id }}/status" class="flex flex-col gap-3 sm:flex-row">
      <select name="status" class="rounded-xl border border-white/10 bg-zinc-900 px-4 py-3 text-sm text-white">
        {% for option in status_options %}
          <option value="{{ option }}" {% if card.status == option %}selected{% endif %}>{{ option }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="rounded-xl bg-emerald-500 px-4 py-3 text-sm font-medium text-zinc-950 hover:bg-emerald-400">Update Status</button>
    </form>
  </div>

  <div class="grid gap-6 xl:grid-cols-[1.2fr,0.8fr]">
    <div class="space-y-6">
      <div class="rounded-2xl border border-white/10 bg-zinc-900/80 p-5">
        <h3 class="text-lg font-semibold text-white">Card Data</h3>
        <dl class="mt-4 grid gap-4 sm:grid-cols-2">
          <div><dt class="text-xs uppercase tracking-[0.2em] text-zinc-500">Theme Source</dt><dd class="mt-1 text-zinc-200">{{ card.theme_source }}</dd></div>
          <div><dt class="text-xs uppercase tracking-[0.2em] text-zinc-500">Event ID</dt><dd class="mt-1 text-zinc-200">{{ card.event_id or '—' }}</dd></div>
          <div class="sm:col-span-2"><dt class="text-xs uppercase tracking-[0.2em] text-zinc-500">Phrase</dt><dd class="mt-1 text-zinc-200">{{ card.phrase or '—' }}</dd></div>
          <div class="sm:col-span-2"><dt class="text-xs uppercase tracking-[0.2em] text-zinc-500">DALL-E Prompt</dt><dd class="mt-1 text-zinc-400">{{ card.dalle_prompt or '—' }}</dd></div>
          <div><dt class="text-xs uppercase tracking-[0.2em] text-zinc-500">Image URL</dt><dd class="mt-1 break-all text-zinc-400">{{ card.image_url or '—' }}</dd></div>
          <div><dt class="text-xs uppercase tracking-[0.2em] text-zinc-500">Final PNG URL</dt><dd class="mt-1 break-all text-zinc-400">{{ card.final_png_url or '—' }}</dd></div>
          <div><dt class="text-xs uppercase tracking-[0.2em] text-zinc-500">Created At</dt><dd class="mt-1 text-zinc-200">{{ card.created_at.strftime('%Y-%m-%d %H:%M:%S %Z') }}</dd></div>
          <div><dt class="text-xs uppercase tracking-[0.2em] text-zinc-500">Candidate Phrases</dt><dd class="mt-1 text-zinc-400">{{ card.candidate_phrases|length }}</dd></div>
        </dl>
      </div>

      {% if card.image_url %}
        <div class="rounded-2xl border border-white/10 bg-zinc-900/80 p-5">
          <h3 class="text-lg font-semibold text-white">Generated Image Preview</h3>
          <img src="{{ card.image_url }}" alt="Generated image preview" class="mt-4 w-full rounded-2xl border border-white/10 object-cover">
        </div>
      {% endif %}

      {% if card.final_png_url %}
        <div class="rounded-2xl border border-white/10 bg-zinc-900/80 p-5">
          <h3 class="text-lg font-semibold text-white">Final Card Preview</h3>
          <img src="{{ card.final_png_url }}" alt="Final card preview" class="mt-4 w-full rounded-2xl border border-white/10 object-cover">
        </div>
      {% endif %}
    </div>

    <div class="space-y-6">
      <div class="rounded-2xl border border-white/10 bg-zinc-900/80 p-5">
        <h3 class="text-lg font-semibold text-white">Cost Breakdown</h3>
        <dl class="mt-4 space-y-3 text-sm">
          <div class="flex items-center justify-between"><dt class="text-zinc-500">LLM cost</dt><dd class="text-zinc-200">${{ '%.4f'|format(card.cost_llm) }}</dd></div>
          <div class="flex items-center justify-between"><dt class="text-zinc-500">Image cost</dt><dd class="text-zinc-200">${{ '%.4f'|format(card.cost_image) }}</dd></div>
          <div class="flex items-center justify-between border-t border-white/10 pt-3"><dt class="font-medium text-white">Total</dt><dd class="font-medium text-emerald-300">${{ '%.4f'|format(total_cost) }}</dd></div>
        </dl>
      </div>

      <div class="rounded-2xl border border-white/10 bg-zinc-900/80 p-5">
        <h3 class="text-lg font-semibold text-white">Quick Actions</h3>
        <div class="mt-4 grid gap-3">
          {% for option in ['phrase_approved', 'image_approved', 'assembly_approved', 'published', 'rejected'] %}
            <form method="post" action="/admin/cards/{{ card.id }}/status">
              <input type="hidden" name="status" value="{{ option }}">
              <button type="submit" class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-left text-sm text-zinc-200 hover:bg-white/10">
                Mark as {{ option }}
              </button>
            </form>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
